'use client';

import { useState } from 'react';
import { useAccount, useWalletClient } from 'wagmi';
import { ConnectButton } from '@rainbow-me/rainbowkit';
import Link from 'next/link';

interface TemplateField {
    name: string;
    label: string;
    placeholder: string;
    type: string;
}

interface ContractTemplate {
    id: string;
    name: string;
    icon: string;
    description: string;
    color: string;
    fields: TemplateField[];
    bytecode: string;
    note?: string;
}

// REAL compiled bytecode from Hardhat
const TEMPLATES: ContractTemplate[] = [
    {
        id: 'erc20',
        name: 'ERC-20 Token',
        icon: 'ü™ô',
        description: 'Your own fungible token',
        color: '#FFD700',
        fields: [],
        note: 'Deploys MyToken (MTK) with 1M supply to your wallet',
        bytecode: '0x60806040526040518060400160405280600781526020017f4d79546f6b656e00000000000000000000000000000000000000000000000000815250600090816200004a919062000420565b506040518060400160405280600381526020017f4d544b00000000000000000000000000000000000000000000000000000000008152506001908162000091919062000420565b506012600260006101000a81548160ff021916908360ff160217905550348015620000bb57600080fd5b50600260009054906101000a900460ff16600a620000da919062000697565b620f4240620000ea9190620006e8565b600381905550600354600460003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020819055503373ffffffffffffffffffffffffffffffffffffffff16600073ffffffffffffffffffffffffffffffffffffffff167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef60035460405162000198919062000744565b60405180910390a362000761565b600081519050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602260045260246000fd5b600060028204905060018216806200022857607f821691505b6020821081036200023e576200023d620001e0565b5b50919050565b60008190508160005260206000209050919050565b60006020601f8301049050919050565b600082821b905092915050565b600060088302620002a87fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff8262000269565b620002b4868362000269565b95508019841693508086168417925050509392505050565b6000819050919050565b6000819050919050565b600062000301620002fb620002f584620002cc565b620002d6565b620002cc565b9050919050565b6000819050919050565b6200031d83620002e0565b620003356200032c8262000308565b84845462000276565b825550505050565b600090565b6200034c6200033d565b6200035981848462000312565b505050565b5b8181101562000381576200037560008262000342565b6001810190506200035f565b5050565b601f821115620003d0576200039a8162000244565b620003a58462000259565b81016020851015620003b5578190505b620003cd620003c48562000259565b8301826200035e565b50505b505050565b600082821c905092915050565b6000620003f560001984600802620003d5565b1980831691505092915050565b6000620004108383620003e2565b9150826002028217905092915050565b6200042b82620001a6565b67ffffffffffffffff811115620004475762000446620001b1565b5b6200045382546200020f565b6200046082828562000385565b600060209050601f83116001811462000498576000841562000483578287015190505b6200048f858262000402565b865550620004ff565b601f198416620004a88662000244565b60005b82811015620004d257848901518255600182019150602085019450602081019050620004ab565b86831015620004f25784890151620004ee601f891682620003e2565b8355505b6001600288020188555050505b505050505050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601160045260246000fd5b60008160011c9050919050565b6000808291508390505b600185111562000595578086048111156200056d576200056c62000507565b5b60018516156200057d5780820291505b80810290506200058d8562000536565b94506200054d565b94509492505050565b600082620005b0576001905062000683565b81620005c0576000905062000683565b8160018114620005d95760028114620005e4576200061a565b600191505062000683565b60ff841115620005f957620005f862000507565b5b8360020a91508482111562000613576200061262000507565b5b5062000683565b5060208310610133831016604e8410600b8410161715620006545782820a9050838111156200064e576200064d62000507565b5b62000683565b62000663848484600162000543565b925090508184048111156200067d576200067c62000507565b5b81810290505b9392505050565b600060ff82169050919050565b6000620006a482620002cc565b9150620006b1836200068a565b9250620006e07fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff84846200059e565b905092915050565b6000620006f582620002cc565b91506200070283620002cc565b92508282026200071281620002cc565b915082820484148315176200072c576200072b62000507565b5b5092915050565b6200073e81620002cc565b82525050565b60006020820190506200075b600083018462000733565b92915050565b610ddc80620007716000396000f3fe608060405234801561001057600080fd5b50600436106100935760003560e01c8063313ce56711610066578063313ce5671461013457806370a082311461015257806395d89b4114610182578063a9059cbb146101a0578063dd62ed3e146101d057610093565b806306fdde0314610098578063095ea7b3146100b657806318160ddd146100e657806323b872dd14610104575b600080fd5b6100a0610200565b6040516100ad9190610985565b60405180910390f35b6100d060048036038101906100cb9190610a40565b61028e565b6040516100dd9190610a9b565b60405180910390f35b6100ee610380565b6040516100fb9190610ac5565b60405180910390f35b61011e60048036038101906101199190610ae0565b610386565b60405161012b9190610a9b565b60405180910390f35b61013c610678565b6040516101499190610b4f565b60405180910390f35b61016c60048036038101906101679190610b6a565b61068b565b6040516101799190610ac5565b60405180910390f35b61018a6106a3565b6040516101979190610985565b60405180910390f35b6101ba60048036038101906101b59190610a40565b610731565b6040516101c79190610a9b565b60405180910390f35b6101ea60048036038101906101e59190610b97565b6108d0565b6040516101f79190610ac5565b60405180910390f35b6000805461020d90610c06565b80601f016020809104026020016040519081016040528092919081815260200182805461023990610c06565b80156102865780601f1061025b57610100808354040283529160200191610286565b820191906000526020600020905b81548152906001019060200180831161026957829003601f168201915b505050505081565b600081600560003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020819055508273ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff167f8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b9258460405161036e9190610ac5565b60405180910390a36001905092915050565b60035481565b600081600460008673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054101561040a576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161040190610c83565b60405180910390fd5b81600560008673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000205410156104c9576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016104c090610cef565b60405180910390fd5b81600560008673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008282546105559190610d3e565b9250508190555081600460008673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008282546105ab9190610d3e565b9250508190555081600460008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008282546106019190610d72565b925050819055508273ffffffffffffffffffffffffffffffffffffffff168473ffffffffffffffffffffffffffffffffffffffff167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef846040516106659190610ac5565b60405180910390a3600190509392505050565b600260009054906101000a900460ff1681565b60046020528060005260406000206000915090505481565b600180546106b090610c06565b80601f01602080910402602001604051908101604052809291908181526020018280546106dc90610c06565b80156107295780601f106106fe57610100808354040283529160200191610729565b820191906000526020600020905b81548152906001019060200180831161070c57829003601f168201915b505050505081565b600081600460003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000205410156107b5576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016107ac90610c83565b60405180910390fd5b81600460003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008282546108049190610d3e565b9250508190555081600460008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600082825461085a9190610d72565b925050819055508273ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef846040516108be9190610ac5565b60405180910390a36001905092915050565b6005602052816000526040600020602052806000526040600020600091509150505481565b600081519050919050565b600082825260208201905092915050565b60005b8381101561092f578082015181840152602081019050610914565b60008484015250505050565b6000601f19601f8301169050919050565b6000610957826108f5565b6109618185610900565b9350610971818560208601610911565b61097a8161093b565b840191505092915050565b6000602082019050818103600083015261099f818461094c565b905092915050565b600080fd5b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b60006109d7826109ac565b9050919050565b6109e7816109cc565b81146109f257600080fd5b50565b600081359050610a04816109de565b92915050565b6000819050919050565b610a1d81610a0a565b8114610a2857600080fd5b50565b600081359050610a3a81610a14565b92915050565b60008060408385031215610a5757610a566109a7565b5b6000610a65858286016109f5565b9250506020610a7685828601610a2b565b9150509250929050565b60008115159050919050565b610a9581610a80565b82525050565b6000602082019050610ab06000830184610a8c565b92915050565b610abf81610a0a565b82525050565b6000602082019050610ada6000830184610ab6565b92915050565b600080600060608486031215610af957610af86109a7565b5b6000610b07868287016109f5565b9350506020610b18868287016109f5565b9250506040610b2986828701610a2b565b9150509250925092565b600060ff82169050919050565b610b4981610b33565b82525050565b6000602082019050610b646000830184610b40565b92915050565b600060208284031215610b8057610b7f6109a7565b5b6000610b8e848285016109f5565b91505092915050565b60008060408385031215610bae57610bad6109a7565b5b6000610bbc858286016109f5565b9250506020610bcd858286016109f5565b9150509250929050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602260045260246000fd5b60006002820490506001821680610c1e57607f821691505b602082108103610c3157610c30610bd7565b5b50919050565b7f496e73756666696369656e742062616c616e6365000000000000000000000000600082015250565b6000610c6d601483610900565b9150610c7882610c37565b602082019050919050565b60006020820190508181036000830152610c9c81610c60565b9050919050565b7f496e73756666696369656e7420616c6c6f77616e636500000000000000000000600082015250565b6000610cd9601683610900565b9150610ce482610ca3565b602082019050919050565b60006020820190508181036000830152610d0881610ccc565b9050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601160045260246000fd5b6000610d4982610a0a565b9150610d5483610a0a565b9250828203905081811115610d6c57610d6b610d0f565b5b92915050565b6000610d7d82610a0a565b9150610d8883610a0a565b9250828201905080821115610da057610d9f610d0f565b5b9291505056fea2646970667358221220898607f88bc4b08f15ca54b492b5ef22d739e9ca2f85cf1b935ba337a4b86a0664736f6c63430008140033',
    },
    {
        id: 'nft',
        name: 'NFT Collection',
        icon: 'üñºÔ∏è',
        description: 'Mintable NFT collection',
        color: '#FF69B4',
        fields: [],
        note: 'Deploys MyNFT (MNFT) - mint NFTs with your own metadata',
        bytecode: '0x60806040526040518060400160405280600581526020017f4d794e4654000000000000000000000000000000000000000000000000000000815250600090816200004a919062000320565b506040518060400160405280600481526020017f4d4e4654000000000000000000000000000000000000000000000000000000008152506001908162000091919062000320565b503480156200009f57600080fd5b5062000407565b600081519050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602260045260246000fd5b600060028204905060018216806200012857607f821691505b6020821081036200013e576200013d620000e0565b5b50919050565b60008190508160005260206000209050919050565b60006020601f8301049050919050565b600082821b905092915050565b600060088302620001a87fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff8262000169565b620001b4868362000169565b95508019841693508086168417925050509392505050565b6000819050919050565b6000819050919050565b600062000201620001fb620001f584620001cc565b620001d6565b620001cc565b9050919050565b6000819050919050565b6200021d83620001e0565b620002356200022c8262000208565b84845462000176565b825550505050565b600090565b6200024c6200023d565b6200025981848462000212565b505050565b5b8181101562000281576200027560008262000242565b6001810190506200025f565b5050565b601f821115620002d0576200029a8162000144565b620002a58462000159565b81016020851015620002b5578190505b620002cd620002c48562000159565b8301826200025e565b50505b505050565b600082821c905092915050565b6000620002f560001984600802620002d5565b1980831691505092915050565b6000620003108383620002e2565b9150826002028217905092915050565b6200032b82620000a6565b67ffffffffffffffff811115620003475762000346620000b1565b5b6200035382546200010f565b6200036082828562000285565b600060209050601f83116001811462000398576000841562000383578287015190505b6200038f858262000302565b865550620003ff565b601f198416620003a88662000144565b60005b82811015620003d257848901518255600182019150602085019450602081019050620003ab565b86831015620003f25784890151620003ee601f891682620002e2565b8355505b6001600288020188555050505b505050505050565b610ed080620004176000396000f3fe608060405234801561001057600080fd5b506004361061007d5760003560e01c806395d89b411161005b57806395d89b4114610100578063a9059cbb1461011e578063c87b56dd1461013a578063d85d3d271461016a5761007d565b806306fdde03146100825780636352211e146100a057806370a08231146100d0575b600080fd5b61008a61019a565b604051610097919061077a565b60405180910390f35b6100ba60048036038101906100b591906107e6565b610228565b6040516100c79190610854565b60405180910390f35b6100ea60048036038101906100e5919061089b565b61025b565b6040516100f791906108d7565b60405180910390f35b610108610273565b604051610115919061077a565b60405180910390f35b610138600480360381019061013391906108f2565b610301565b005b610154600480360381019061014f91906107e6565b6104fd565b604051610161919061077a565b60405180910390f35b610184600480360381019061017f9190610a67565b61059d565b60405161019191906108d7565b60405180910390f35b600080546101a790610adf565b80601f01602080910402602001604051908101604052809291908181526020018280546101d390610adf565b80156102205780601f106101f557610100808354040283529160200191610220565b820191906000526020600020905b81548152906001019060200180831161020357829003601f168201915b505050505081565b60036020528060005260406000206000915054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b60046020528060005260406000206000915090505481565b6001805461028090610adf565b80601f01602080910402602001604051908101604052809291908181526020018280546102ac90610adf565b80156102f95780601f106102ce576101008083540402835291602001916102f9565b820191906000526020600020905b8154815290600101906020018083116102dc57829003601f168201915b505050505081565b3373ffffffffffffffffffffffffffffffffffffffff166003600083815260200190815260200160002060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16146103a2576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161039990610b5c565b60405180910390fd5b816003600083815260200190815260200160002060006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550600460003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600081548092919061044490610bab565b9190505550600460008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600081548092919061049990610bd4565b9190505550808273ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef60405160405180910390a45050565b6005602052806000526040600020600091509050805461051c90610adf565b80601f016020809104026020016040519081016040528092919081815260200182805461054890610adf565b80156105955780601f1061056a57610100808354040283529160200191610595565b820191906000526020600020905b81548152906001019060200180831161057857829003601f168201915b505050505081565b6000806002549050600260008154809291906105b890610bd4565b9190505550336003600083815260200190815260200160002060006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550600460003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600081548092919061065f90610bd4565b9190505550826005600083815260200190815260200160002090816106849190610dc8565b50803373ffffffffffffffffffffffffffffffffffffffff16600073ffffffffffffffffffffffffffffffffffffffff167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef60405160405180910390a480915050919050565b600081519050919050565b600082825260208201905092915050565b60005b83811015610724578082015181840152602081019050610709565b60008484015250505050565b6000601f19601f8301169050919050565b600061074c826106ea565b61075681856106f5565b9350610766818560208601610706565b61076f81610730565b840191505092915050565b600060208201905081810360008301526107948184610741565b905092915050565b6000604051905090565b600080fd5b600080fd5b6000819050919050565b6107c3816107b0565b81146107ce57600080fd5b50565b6000813590506107e0816107ba565b92915050565b6000602082840312156107fc576107fb6107a6565b5b600061080a848285016107d1565b91505092915050565b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b600061083e82610813565b9050919050565b61084e81610833565b82525050565b60006020820190506108696000830184610845565b92915050565b61087881610833565b811461088357600080fd5b50565b6000813590506108958161086f565b92915050565b6000602082840312156108b1576108b06107a6565b5b60006108bf84828501610886565b91505092915050565b6108d1816107b0565b82525050565b60006020820190506108ec60008301846108c8565b92915050565b60008060408385031215610909576109086107a6565b5b600061091785828601610886565b9250506020610928858286016107d1565b9150509250929050565b600080fd5b600080fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b61097482610730565b810181811067ffffffffffffffff821117156109935761099261093c565b5b80604052505050565b60006109a661079c565b90506109b2828261096b565b919050565b600067ffffffffffffffff8211156109d2576109d161093c565b5b6109db82610730565b9050602081019050919050565b82818337600083830152505050565b6000610a0a610a05846109b7565b61099c565b905082815260208101848484011115610a2657610a25610937565b5b610a318482856109e8565b509392505050565b600082601f830112610a4e57610a4d610932565b5b8135610a5e8482602086016109f7565b91505092915050565b600060208284031215610a7d57610a7c6107a6565b5b600082013567ffffffffffffffff811115610a9b57610a9a6107ab565b5b610aa784828501610a39565b91505092915050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602260045260246000fd5b60006002820490506001821680610af757607f821691505b602082108103610b0a57610b09610ab0565b5b50919050565b7f4e6f74206f776e65720000000000000000000000000000000000000000000000600082015250565b6000610b466009836106f5565b9150610b5182610b10565b602082019050919050565b60006020820190508181036000830152610b7581610b39565b9050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601160045260246000fd5b6000610bb6826107b0565b915060008203610bc957610bc8610b7c565b5b600182039050919050565b6000610bdf826107b0565b91507fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff8203610c1157610c10610b7c565b5b600182019050919050565b60008190508160005260206000209050919050565b60006020601f8301049050919050565b600082821b905092915050565b600060088302610c7e7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff82610c41565b610c888683610c41565b95508019841693508086168417925050509392505050565b6000819050919050565b6000610cc5610cc0610cbb846107b0565b610ca0565b6107b0565b9050919050565b6000819050919050565b610cdf83610caa565b610cf3610ceb82610ccc565b848454610c4e565b825550505050565b600090565b610d08610cfb565b610d13818484610cd6565b505050565b5b81811015610d3757610d2c600082610d00565b600181019050610d19565b5050565b601f821115610d7c57610d4d81610c1c565b610d5684610c31565b81016020851015610d65578190505b610d79610d7185610c31565b830182610d18565b50505b505050565b600082821c905092915050565b6000610d9f60001984600802610d81565b1980831691505092915050565b6000610db88383610d8e565b9150826002028217905092915050565b610dd1826106ea565b67ffffffffffffffff811115610dea57610de961093c565b5b610df48254610adf565b610dff828285610d3b565b600060209050601f831160018114610e325760008415610e20578287015190505b610e2a8582610dac565b865550610e92565b601f198416610e4086610c1c565b60005b82811015610e6857848901518255600182019150602085019450602081019050610e43565b86831015610e855784890151610e81601f891682610d8e565b8355505b6001600288020188555050505b50505050505056fea2646970667358221220e9abf3c5c6686533bbcbeac8556a84c2501e68e867fc03586b74cecac9cecf2664736f6c63430008140033',
    },
];

interface DeployResult {
    success: boolean;
    txHash?: string;
    contractAddress?: string;
    error?: string;
}

export default function DeployPage() {
    const { isConnected } = useAccount();
    const { data: walletClient } = useWalletClient();

    const [step, setStep] = useState(1);
    const [selectedTemplate, setSelectedTemplate] = useState<ContractTemplate | null>(null);
    const [formData, setFormData] = useState<Record<string, string>>({});
    const [deploying, setDeploying] = useState(false);
    const [result, setResult] = useState<DeployResult | null>(null);

    const handleTemplateSelect = (template: ContractTemplate) => {
        setSelectedTemplate(template);
        setFormData({});
        setResult(null);
        setStep(2);
    };

    const handleFieldChange = (name: string, value: string) => {
        setFormData(prev => ({ ...prev, [name]: value }));
    };

    const canDeploy = () => {
        if (selectedTemplate.fields.length === 0) return true;
        return selectedTemplate.fields.every(field => formData[field.name]?.trim());
    };

    const deployContract = async () => {

        setDeploying(true);
        setResult(null);

        try {
            const hash = await walletClient.sendTransaction({
                data: selectedTemplate.bytecode as `0x${string}`,
                gas: BigInt(5000000),
            });

            setResult({ success: true, txHash: hash });
            setStep(3);
        } catch (error: unknown) {
            const err = error as { message?: string };
            const msg = err.message || 'Deployment failed';
            setResult({ success: false, error: msg.includes('denied') ? 'Transaction cancelled' : msg.slice(0, 150) });
        } finally {
            setDeploying(false);
        }
    };

    const resetFlow = () => {
        setStep(1);
        setSelectedTemplate(null);
        setFormData({});
        setResult(null);
    };

    return (
        <div className="min-h-screen" style={{ background: 'linear-gradient(180deg, #0a0a1a 0%, #1a1a3e 50%, #0a0a1a 100%)' }}>
            <header style={{ background: 'rgba(0,0,0,0.4)', backdropFilter: 'blur(20px)', borderBottom: '1px solid rgba(255,255,255,0.08)', position: 'sticky', top: 0, zIndex: 100 }}>
                <div className="max-w-6xl mx-auto px-4 py-4 flex items-center justify-between">
                    <Link href="/" className="flex items-center gap-3">
                        <div style={{ width: '44px', height: '44px', borderRadius: '14px', background: 'linear-gradient(135deg, #00D4FF, #00FF88)', display: 'flex', alignItems: 'center', justifyContent: 'center', fontWeight: 'bold', fontSize: '16px' }}>CSC</div>
                        <div><span className="text-lg font-bold text-white">Deploy Contract</span><span className="text-xs text-gray-500 block">CSC Testnet</span></div>
                    </Link>
                    <ConnectButton />
                </div>
            </header>

            <main className="max-w-4xl mx-auto px-4 py-8">
                <div style={{ display: 'flex', justifyContent: 'center', gap: '8px', marginBottom: '40px' }}>
                    {[1, 2, 3].map(s => (
                        <div key={s} onClick={() => s < step && setStep(s)} style={{ display: 'flex', alignItems: 'center', gap: '8px', padding: '10px 20px', borderRadius: '50px', background: step >= s ? 'linear-gradient(135deg, rgba(0,212,255,0.2), rgba(0,255,136,0.2))' : 'rgba(255,255,255,0.03)', border: `1px solid ${step >= s ? 'rgba(0,212,255,0.4)' : 'rgba(255,255,255,0.08)'}`, cursor: s < step ? 'pointer' : 'default' }}>
                            <div style={{ width: '28px', height: '28px', borderRadius: '50%', background: step >= s ? 'linear-gradient(135deg, #00D4FF, #00FF88)' : 'rgba(255,255,255,0.1)', display: 'flex', alignItems: 'center', justifyContent: 'center', color: step >= s ? 'black' : '#666', fontWeight: 'bold', fontSize: '14px' }}>{step > s ? '‚úì' : s}</div>
                            <span style={{ color: step >= s ? 'white' : '#666', fontSize: '14px' }}>{s === 1 ? 'Select' : s === 2 ? 'Deploy' : 'Done'}</span>
                        </div>
                    ))}
                </div>

                <div style={{ background: 'linear-gradient(135deg, rgba(0,212,255,0.05), rgba(0,255,136,0.05))', borderRadius: '24px', padding: '60px', textAlign: 'center', border: '1px solid rgba(0,212,255,0.2)' }}>
                    <div style={{ fontSize: '64px', marginBottom: '24px' }}>üîó</div>
                    <h2 style={{ color: 'white', fontSize: '24px', marginBottom: '12px' }}>Connect Your Wallet</h2>
                    <p style={{ color: '#888', marginBottom: '32px' }}>Connect your wallet to deploy contracts on CSC Testnet</p>
                    <ConnectButton />
                </div>
                ) : step === 1 ? (
                <div>
                    <div style={{ textAlign: 'center', marginBottom: '32px' }}><h1 style={{ color: 'white', fontSize: '28px', marginBottom: '8px' }}>Choose Your Contract</h1><p style={{ color: '#888' }}>Select a template to deploy</p></div>
                    <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(280px, 1fr))', gap: '20px' }}>
                        {TEMPLATES.map(t => (
                            <button key={t.id} onClick={() => handleTemplateSelect(t)} style={{ background: 'rgba(255,255,255,0.03)', borderRadius: '20px', padding: '28px', border: '1px solid rgba(255,255,255,0.08)', cursor: 'pointer', textAlign: 'left', transition: 'all 0.3s' }} onMouseEnter={e => { e.currentTarget.style.background = 'rgba(255,255,255,0.06)'; e.currentTarget.style.borderColor = t.color; e.currentTarget.style.transform = 'translateY(-4px)'; }} onMouseLeave={e => { e.currentTarget.style.background = 'rgba(255,255,255,0.03)'; e.currentTarget.style.borderColor = 'rgba(255,255,255,0.08)'; e.currentTarget.style.transform = 'translateY(0)'; }}>
                                <div style={{ width: '60px', height: '60px', borderRadius: '16px', background: t.color + '20', display: 'flex', alignItems: 'center', justifyContent: 'center', fontSize: '32px', marginBottom: '16px' }}>{t.icon}</div>
                                <h3 style={{ color: 'white', fontSize: '18px', marginBottom: '8px' }}>{t.name}</h3>
                                <p style={{ color: '#888', fontSize: '14px', margin: 0 }}>{t.description}</p>
                                {t.note && <p style={{ color: '#666', fontSize: '12px', marginTop: '8px', fontStyle: 'italic' }}>{t.note}</p>}
                            </button>
                        ))}
                    </div>
                </div>
                ) : step === 2 ? (
                <div>
                    <button onClick={() => setStep(1)} style={{ background: 'none', border: 'none', color: '#888', cursor: 'pointer', marginBottom: '24px', display: 'flex', alignItems: 'center', gap: '8px' }}>‚Üê Back</button>
                    <div style={{ background: 'rgba(255,255,255,0.03)', borderRadius: '24px', padding: '32px', border: '1px solid rgba(255,255,255,0.08)' }}>
                        <div style={{ display: 'flex', alignItems: 'center', gap: '16px', marginBottom: '32px' }}>
                            <div style={{ width: '64px', height: '64px', borderRadius: '16px', background: (selectedTemplate?.color || '#00D4FF') + '20', display: 'flex', alignItems: 'center', justifyContent: 'center', fontSize: '36px' }}>{selectedTemplate?.icon}</div>
                            <div><h2 style={{ color: 'white', fontSize: '24px', margin: 0 }}>{selectedTemplate?.name}</h2><p style={{ color: '#888', margin: 0 }}>{selectedTemplate?.description}</p>{selectedTemplate?.note && <p style={{ color: '#666', fontSize: '13px', marginTop: '4px' }}>{selectedTemplate.note}</p>}</div>
                        </div>

                        {selectedTemplate?.fields && selectedTemplate.fields.length > 0 ? (
                            <div style={{ display: 'flex', flexDirection: 'column', gap: '20px' }}>
                                {selectedTemplate.fields.map(f => (
                                    <div key={f.name}><label style={{ color: '#888', fontSize: '14px', marginBottom: '8px', display: 'block' }}>{f.label}</label><input type={f.type} value={formData[f.name] || ''} onChange={e => handleFieldChange(f.name, e.target.value)} placeholder={f.placeholder} style={{ width: '100%', padding: '16px 20px', borderRadius: '14px', background: 'rgba(0,0,0,0.3)', border: '1px solid rgba(255,255,255,0.1)', color: 'white', fontSize: '16px', outline: 'none' }} /></div>
                                ))}
                            </div>
                        ) : (
                            <div style={{ color: '#888', textAlign: 'center', padding: '20px', background: 'rgba(0,255,136,0.05)', borderRadius: '12px', border: '1px solid rgba(0,255,136,0.2)' }}>‚úì Ready to deploy! No configuration needed.</div>
                        )}

                        <button onClick={deployContract} disabled={deploying || !canDeploy()} style={{ width: '100%', marginTop: '32px', padding: '18px', borderRadius: '14px', background: deploying || !canDeploy() ? 'rgba(100,100,100,0.3)' : 'linear-gradient(135deg, ' + (selectedTemplate?.color || '#00D4FF') + ', #00FF88)', border: 'none', color: deploying || !canDeploy() ? '#666' : 'black', fontSize: '18px', fontWeight: 'bold', cursor: deploying || !canDeploy() ? 'not-allowed' : 'pointer' }}>{deploying ? '‚è≥ Deploying...' : 'üöÄ Deploy Contract'}</button>

                        {result && !result.success && <div style={{ marginTop: '20px', padding: '16px', borderRadius: '12px', background: 'rgba(255,100,100,0.1)', border: '1px solid rgba(255,100,100,0.3)', color: '#ff6464', maxHeight: '100px', overflow: 'auto', wordBreak: 'break-word', fontSize: '14px' }}>‚ùå {result.error}</div>}
                    </div>
                </div>
                ) : (
                <div style={{ background: 'linear-gradient(135deg, rgba(0,255,136,0.05), rgba(0,212,255,0.05))', borderRadius: '24px', padding: '48px', textAlign: 'center', border: '1px solid rgba(0,255,136,0.3)' }}>
                    <div style={{ width: '100px', height: '100px', borderRadius: '50%', background: 'linear-gradient(135deg, #00FF88, #00D4FF)', display: 'flex', alignItems: 'center', justifyContent: 'center', fontSize: '48px', margin: '0 auto 24px', boxShadow: '0 0 60px rgba(0,255,136,0.4)' }}>‚úì</div>
                    <h2 style={{ color: 'white', fontSize: '28px', marginBottom: '12px' }}>Contract Deployed! üéâ</h2>
                    <p style={{ color: '#888', marginBottom: '24px' }}>Your {selectedTemplate?.name} is live on CSC Testnet</p>
                    {result?.txHash && <div style={{ background: 'rgba(0,0,0,0.3)', borderRadius: '12px', padding: '16px', marginBottom: '24px' }}><div style={{ color: '#888', fontSize: '12px', marginBottom: '4px' }}>Transaction Hash</div><a href={`/tx/${result.txHash}`} style={{ color: '#00D4FF', fontSize: '14px', fontFamily: 'monospace', wordBreak: 'break-all' }}>{result.txHash}</a></div>}
                    <div style={{ display: 'flex', gap: '12px', justifyContent: 'center', flexWrap: 'wrap' }}><Link href={`/tx/${result?.txHash}`} style={{ padding: '14px 28px', borderRadius: '12px', background: 'linear-gradient(135deg, #00D4FF, #00FF88)', color: 'black', textDecoration: 'none', fontWeight: 'bold' }}>View Transaction</Link><button onClick={resetFlow} style={{ padding: '14px 28px', borderRadius: '12px', background: 'rgba(255,255,255,0.1)', border: '1px solid rgba(255,255,255,0.2)', color: 'white', cursor: 'pointer', fontWeight: 'bold' }}>Deploy Another</button></div>
                </div>
                )}

                <div style={{ marginTop: '48px', padding: '24px', borderRadius: '16px', background: 'rgba(255,255,255,0.02)', border: '1px solid rgba(255,255,255,0.05)' }}>
                    <h3 style={{ color: 'white', marginBottom: '16px', fontSize: '16px' }}>üí° Need Help?</h3>
                    <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))', gap: '16px' }}><Link href="/faucet" style={{ color: '#00D4FF', textDecoration: 'none', fontSize: '14px' }}>üíß Get free CSC</Link><Link href="/docs" style={{ color: '#00D4FF', textDecoration: 'none', fontSize: '14px' }}>üìö Docs</Link><Link href="/tokens" style={{ color: '#00D4FF', textDecoration: 'none', fontSize: '14px' }}>ü™ô View tokens</Link></div>
                </div>
            </main>
        </div>
    );
}
